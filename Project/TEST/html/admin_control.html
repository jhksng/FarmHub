<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_control.css') }}">

<div class="control-container">
    <h2>장치 수동 제어</h2>

    <div class="device-grid">

      {% for name, pin in pins.items() %}
      <div class="device">
          <span class="device-name">{{ name }}</span>
          <div class="btn-group">
              <button class="btn-on {% if device_state[pin] == 0 %}active{% else %}inactive{% endif %}" onclick="control({{ pin }}, 0)">ON</button>
              
              <button class="btn-off {% if device_state[pin] == 1 %}active{% else %}inactive{% endif %}" onclick="control({{ pin }}, 1)">OFF</button>

              <button class="btn-auto {% if not manual_override[name] %}active{% endif %}" onclick="setAuto('{{ name }}')">AUTO</button>
          </div>
      </div>
      {% endfor %}

    </div>
</div>

<script>
    // 'ON' 또는 'OFF' 버튼을 눌렀을 때 실행되는 함수
    function control(pin, state) {
        // '/controller' 주소로 핀 번호와 상태(0 또는 1)를 POST 방식으로 전송
        fetch('/controller', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `${pin}=${state}`
        }).then(() => {
            // 서버가 응답하면, 페이지를 새로고침해서 변경된 상태를 버튼 색상에 반영
            location.reload();
        });
    }

    // 'AUTO' 버튼을 눌렀을 때 실행되는 함수
    function setAuto(deviceName) {
        // '/auto_mode/장치이름' 주소로 POST 요청을 보냄
        fetch(`/auto_mode/${deviceName}`, {
            method: 'POST'
        }).then(() => {
            // 성공 시 페이지 새로고침
            location.reload();
        });
    }
</script>
