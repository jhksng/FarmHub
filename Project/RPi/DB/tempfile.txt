//데이터베이스에 데이터를 직접주고 웹에서 입출력하는 임시 데이터 파일 용도

use smartparm;

-- 기존 테이블 제거 (존재할 경우)
DROP TABLE IF EXISTS user_crop_selection;
DROP TABLE IF EXISTS crop_logs;
DROP TABLE IF EXISTS custom_crop_info;
DROP TABLE IF EXISTS crop_info;
DROP TABLE IF EXISTS users;
-- 사용자 테이블
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(20) NOT NULL UNIQUE,
    password VARCHAR(30) NOT NULL
);

INSERT INTO users (id, username, password) VALUES (1, 'admin', 'admin');

ALTER TABLE users ADD COLUMN selected_crop VARCHAR(100) DEFAULT NULL;
-- 공통 작물 정보 테이블
CREATE TABLE crop_info (
    id INT AUTO_INCREMENT PRIMARY KEY,
    crop VARCHAR(20) NOT NULL UNIQUE,  -- 작물 이름 (유일하게 설정)
    temp FLOAT,                        -- 적정 온도
    humidity FLOAT,                    -- 적정 습도
    light INT,                         -- 적정 조도
    water INT,                         -- 물 주는 주기 (시간)
    growth FLOAT,                      -- 자라는 데 걸리는 시간
    description TEXT,                  -- 설명
    image VARCHAR(255)                 -- 이미지 파일 이름
);

-- 사용자 지정 작물 테이블
CREATE TABLE custom_crop_info (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    crop VARCHAR(20) NOT NULL,         -- 사용자 작물 이름
    temp FLOAT,
    humidity FLOAT,
    light INT,
    water INT,
    growth FLOAT,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 작물 환경 기록 테이블 (센서 로그)
CREATE TABLE crop_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    crop_id INT NOT NULL,                      -- crop_info.id 참조
    recorded_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- 측정 시각
    temp FLOAT,                                -- 측정 온도
    humidity FLOAT,                            -- 측정 습도
    light INT,                                 -- 측정 조도
    growth FLOAT,                              -- 측정 생장 수치
    FOREIGN KEY (crop_id) REFERENCES crop_info(id) ON DELETE CASCADE
);

-- 사용자별 현재 선택 작물 저장
CREATE TABLE user_crop_selection (
    user_id INT NOT NULL PRIMARY KEY,
    selected_crop VARCHAR(20) NOT NULL,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 작물 데이터 삽입 (이미지와 설명 포함)
INSERT INTO crop_info (crop, temp, humidity, light, water, growth, image, description) VALUES
('상추', 20, 48, 8, 4, 6.7, 'lettuce.jpg', '상추는 햇빛을 좋아하며 서늘한 기후에서 잘 자랍니다.'),
('딸기', 22, 46, 8, 3, 7.7, 'strawberry.jpg', '딸기는 온화한 기후에서 잘 자라며, 햇볕이 잘 드는 곳에서 풍부한 수확을 기대할 수 있습니다.'),
('깻잎', 16, 60, 7, 2, 10, 'perillaLeaves.jpg', '깻잎은 따뜻하고 습한 환경을 좋아하며, 통풍이 잘되는 곳에서 향이 풍부하게 자랍니다.');

INSERT INTO crop_logs (crop_id, recorded_at, temp, humidity, light, growth)
VALUES ((SELECT id FROM crop_info WHERE crop = '상추'), '2025-05-20 23:50:40', 20, 48, 32050, 6.7);

SELECT * FROM crop_info;
SELECT * FROM crop_logs;
SELECT * FROM custom_crop_info;
SELECT * FROM users;
